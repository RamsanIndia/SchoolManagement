# Main Azure DevOps Pipeline Entry Point
# School Management Application - .NET Core 8 + React TypeScript

trigger:
  branches:
    include:
    - main
    - develop
  paths:
    exclude:
    - README.md
    - docs/*

pr:
  branches:
    include:
    - main
    - develop

# Use the build pipeline for CI
resources:
  repositories:
  - repository: self

variables:
  - group: school-app-variables

stages:
# Stage 1: Build (CI)
- template: build-pipeline.yml

# Stage 2: Deploy to Development
- template: release-pipeline.yml
  parameters:
    environment: 'development'
    dependsOn: 'Build'
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/develop'))

# Stage 3: Deploy to Production
- template: release-pipeline.yml
  parameters:
    environment: 'production'
    dependsOn: 'Build'
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/main'))